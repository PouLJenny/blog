---
layout: post
title:  "里氏替换原则(LSP)"
date:   2024-03-18 14:28:00 +0800
categories: 设计模式 设计原则
tags: 设计模式 设计原则
permalink: /patterns/lsp
published: true
publish_file: 2024-03-18-patterns-lsp.md
toc: true
---
# Liskov Substitution Principle/里氏替换原则(LSP)

[wiki](https://en.wikipedia.org/wiki/Liskov_substitution_principle)

## 定义

由Barbara Liskov在1987 首次提出。 [Data abstraction and hierarchy](https://www.cs.tufts.edu/~nr/cs257/archive/barbara-liskov/data-abstraction-and-hierarchy.pdf).

原始定义：
> if S is a subtype of T, then objects of type T in a program may be replaced with objects of type S without altering any of the desirable properties of that program

中文：
> 如果S是T的子类型，那么程序中类型为T的对象可以被类型为S的对象替换，而不会改变程序的任何可取属性。

## Java实践

在Java中实践Liskov Substitution Principle（LSP）时，有几个方面需要特别注意：

1. **遵循继承的约束**：在设计类的继承关系时，确保子类能够完全替换父类而不影响程序的行为。子类应该保留父类的所有约束、前置条件和后置条件，并且不能增加新的异常情况或改变原有的行为。
2. **合理使用抽象类和接口**：在Java中，可以使用抽象类和接口来定义通用的行为。子类应该实现这些抽象类或接口，并且在不改变父类行为的前提下，可以根据需要进行扩展或重写方法。
3. **重写方法要符合LSP**：在子类中重写方法时，确保方法的行为与父类中的方法保持一致，并且不会违反父类方法的前置条件和后置条件。子类可以扩展方法的功能，但不能改变方法的原有约定。
4. **谨慎使用继承**：尽量避免使用过深的继承层次，过深的继承层次会增加代码的复杂性，并且可能导致LSP的违反。如果发现继承关系过于复杂或不合理，可以考虑使用组合或委托等其他设计模式来替代继承。
5. **进行适当的测试**：在实现继承关系时，进行适当的单元测试以验证子类能够正确地替换父类。确保测试覆盖所有的子类，并验证子类在替换父类时不会破坏程序的正确性。
6. **尽量避免使用类型检查和转换**：在使用继承关系时，尽量避免使用类型检查和强制类型转换，因为这可能会违反LSP。如果需要进行类型检查或转换，考虑使用多态性和接口来替代。

通过遵循上述注意事项，可以更好地在Java中实践Liskov Substitution Principle，从而编写出符合面向对象设计原则的高质量代码。

## 优点

1. **代码重用性**：LSP鼓励通过继承来实现代码重用，因为派生类可以替代基类。这意味着您可以使用通用的基类方法来处理所有派生类的实例，从而减少代码的重复性。
2. **可扩展性**：通过遵循LSP，您可以轻松地添加新的子类而无需修改现有的代码。这提高了代码的可扩展性，使您的系统更易于维护和扩展。
3. **依赖倒置**：LSP与依赖倒置原则（DIP）密切相关。依赖倒置原则要求高层模块不应该依赖于低层模块，而是应该依赖于抽象。LSP的应用使得通过抽象类或接口来定义通用的行为成为可能，从而符合依赖倒置原则。
4. **简化测试**：LSP鼓励在派生类中保持基类的行为。这意味着您可以在基类的单元测试中验证一些通用的行为，而不需要为每个派生类编写额外的测试。这简化了测试工作并提高了测试覆盖率。
5. **提高代码的可读性和可维护性**：通过明确规定了子类型与基类型之间的关系，LSP使得代码更易于理解和维护。程序员可以更容易地理解代码的意图，并且在不破坏现有功能的前提下进行修改和扩展。


## 缺点

1. **抽象程度的权衡**： 为了遵循LSP，通常需要定义更加抽象的接口或基类，以便让子类能够替换父类。这可能会增加代码的复杂性和抽象程度，使得代码难以理解和维护。
2. **设计复杂性增加**： 遵循LSP可能会导致设计更加复杂的类层次结构。为了确保子类能够替换父类而不违反程序的行为，可能需要引入更多的抽象类或接口，增加系统的设计复杂性。
3. **限制灵活性**： 有时为了遵循LSP，需要在子类中保持与父类相同的行为。这可能会限制子类的灵活性，使得子类无法添加新的行为或改变现有的行为，从而影响到系统的扩展性和灵活性。
4. **可能导致性能问题**： 在某些情况下，为了满足LSP的要求，可能需要在子类中实现更复杂的算法或数据结构。这可能会导致性能问题，因为复杂的算法通常会消耗更多的系统资源。
5. **需要更多的测试**： 遵循LSP可能需要编写更多的测试用例来验证子类能够正确地替换父类。这增加了测试的工作量，并且可能需要更多的时间和资源来进行测试。

